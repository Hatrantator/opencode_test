[gd_resource type="ShaderMaterial" format=3 uid="uid://btwy1l3v725oi"]

[sub_resource type="Shader" id="Shader_v1iwn"]
code = "shader_type spatial;
render_mode world_vertex_coords, ensure_correct_normals;

#include \"res://addons/gd_shader_lib/shaders/includes/hue_mask.gdshaderinc\"

uniform sampler2D tex_x;
uniform sampler2D tex_y;
uniform sampler2D tex_z;

uniform vec3 flat_color  : source_color = vec3(0.1, 0.6, 0.1);
uniform vec3 steep_color : source_color = vec3(0.45, 0.3, 0.15);

uniform float bottom_threshold = 3.5;
uniform float slope_start = 0.7;
uniform float slope_end   = 0.9;
uniform float texture_scale = 0.1;

varying vec3 world_pos;
varying vec3 world_nrm;

void vertex() {
    world_pos = VERTEX;

    // Transform normal to world space
    world_nrm = normalize((MODEL_MATRIX * vec4(NORMAL, 0.0)).xyz);
	hue = hueValue(world_pos, hueMaskTexture);
}

vec3 triplanar(vec3 pos, vec3 nrm) {
    vec3 n = abs(nrm);
    n = max(n, 0.0001);
    n /= (n.x + n.y + n.z);

    vec3 x = texture(tex_x, pos.yz * texture_scale).rgb;
    vec3 y = texture(tex_y, pos.xz * texture_scale).rgb;
    vec3 z = texture(tex_z, pos.xy * texture_scale).rgb;

    return x * n.x + y * n.y + z * n.z;
}

void fragment() {
    vec3 nrm = normalize(world_nrm);

    // Triplanar texture
    vec3 tex_color = triplanar(world_pos, nrm);

    // Slope blend using WORLD UP
    float slope = dot(nrm, vec3(0.0, 1.0, 0.0));
    float t = smoothstep(slope_start, slope_end, slope);

    vec3 slope_color = mix(steep_color, flat_color*hue, t);

	if (world_pos.y < bottom_threshold) {
		 ALBEDO = tex_color * steep_color;
	} else {
    	ALBEDO = tex_color * slope_color;
	}
	//ALBEDO = tex_color * slope_color;
}
"

[sub_resource type="Gradient" id="Gradient_v4rm0"]

[sub_resource type="FastNoiseLite" id="FastNoiseLite_5h8eu"]
noise_type = 2
frequency = 0.0422
fractal_type = 0
cellular_return_type = 0

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_478qy"]
width = 256
height = 256
noise = SubResource("FastNoiseLite_5h8eu")
color_ramp = SubResource("Gradient_v4rm0")

[resource]
render_priority = 0
shader = SubResource("Shader_v1iwn")
shader_parameter/hueMaskTexture = SubResource("NoiseTexture2D_478qy")
shader_parameter/hueMaskScale = 64.0
shader_parameter/tex_x = SubResource("NoiseTexture2D_478qy")
shader_parameter/tex_z = SubResource("NoiseTexture2D_478qy")
shader_parameter/flat_color = Color(0.19607843, 0.35686275, 0.09411765, 1)
shader_parameter/steep_color = Color(0.3726681, 0.21457446, 0.11075907, 1)
shader_parameter/bottom_threshold = 2.0
shader_parameter/slope_start = 0.8
shader_parameter/slope_end = 0.95
shader_parameter/texture_scale = 0.1
